# Decky QQ Music æ’ä»¶

<p align="center">
  <img src="./assets/decky_music_logo_small.png" width="600" />
</p>

åœ¨ Steam Deck ä¸Šäº«å— QQ éŸ³ä¹çš„ Decky Loader æ’ä»¶ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ” **æ‰«ç ç™»å½•** - æ”¯æŒ QQ å’Œå¾®ä¿¡æ‰«ç ç™»å½•
- ğŸ“… **æ¯æ—¥æ¨è** - ä¸ªæ€§åŒ–æ¯æ—¥æ¨èæ­Œæ›²
- ğŸ’¡ **çŒœä½ å–œæ¬¢** - æ™ºèƒ½æ¨èï¼Œæ”¯æŒæ¢ä¸€æ‰¹
- ğŸ” **æ­Œæ›²æœç´¢** - æ”¯æŒå…³é”®è¯æœç´¢ï¼Œæ˜¾ç¤ºçƒ­é—¨æœç´¢
- ğŸµ **éŸ³ä¹æ’­æ”¾** - åœ¨çº¿æ’­æ”¾æ­Œæ›²ï¼Œæ”¯æŒæ’­æ”¾æ§åˆ¶
- ğŸ“ **æ­Œè¯æ˜¾ç¤º** - è·å–æ­Œè¯ä¿¡æ¯
- ğŸ’¾ **ç™»å½•çŠ¶æ€ä¿å­˜** - è‡ªåŠ¨ä¿å­˜ç™»å½•å‡­è¯ï¼Œæ— éœ€é‡å¤ç™»å½•

## ğŸ“¦ å®‰è£…

### å‰ææ¡ä»¶

- Steam Deck å·²å®‰è£… [Decky Loader](https://github.com/SteamDeckHomebrew/decky-loader)
- Node.js v16.14+ å’Œ pnpm v9

### ä» Release å®‰è£…ï¼ˆæ¨èï¼‰

1. ä» [Releases](https://github.com/jinzhongjia/decky-qqmusic/releases) ä¸‹è½½æœ€æ–°çš„ `QQMusic.zip`
2. ä½¿ç”¨ Steam Decky çš„å¼€å‘è€…æ¨¡å¼å®‰è£…æœ¬æ’ä»¶

### ä»æºç æ„å»º

> âš ï¸ æ³¨æ„ï¼šä½¿ç”¨ Docker æ„å»ºï¼Œç¡®ä¿å·²å®‰è£… Dockerã€‚

**æ–¹æ³• 1ï¼šä½¿ç”¨ GitHub Actionsï¼ˆæ¨èï¼‰**

Fork æ­¤ä»“åº“åï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ„å»ºã€‚åˆ›å»º tag æ—¶ä¼šè‡ªåŠ¨å‘å¸ƒ Releaseã€‚

**æ–¹æ³• 2ï¼šæœ¬åœ°æ„å»º**

éœ€è¦å®‰è£… [mise](https://mise.jdx.dev/) å’Œ Dockerã€‚

```bash
git clone https://github.com/your-username/decky-qqmusic.git
cd decky-qqmusic

# æ„å»º
mise run build

# è¾“å‡ºæ–‡ä»¶: out/QQMusic.zip å’Œ out/QQMusic/
```

## ğŸ® ä½¿ç”¨æ–¹æ³•

### ç™»å½•

1. æ‰“å¼€ Steam Deck çš„æ¸¸æˆæ¨¡å¼
2. æŒ‰ä¸‹ `...` æŒ‰é’®æ‰“å¼€å¿«é€Ÿè®¿é—®èœå•
3. åˆ‡æ¢åˆ° Decky æ’ä»¶æ ‡ç­¾é¡µ
4. æ‰¾åˆ°å¹¶æ‰“å¼€ "QQéŸ³ä¹" æ’ä»¶
5. é€‰æ‹© "QQæ‰«ç ç™»å½•" æˆ– "å¾®ä¿¡æ‰«ç ç™»å½•"
6. ä½¿ç”¨æ‰‹æœºæ‰«æäºŒç»´ç å¹¶ç¡®è®¤ç™»å½•

### é¦–é¡µåŠŸèƒ½

- **æ¯æ—¥æ¨è** - ç™»å½•åæ˜¾ç¤ºä¸ªæ€§åŒ–æ¨èæ­Œæ›²
- **çŒœä½ å–œæ¬¢** - æ˜¾ç¤ºæ¨èæ­Œæ›²ï¼Œå¯ç‚¹å‡»"æ¢ä¸€æ‰¹"åˆ·æ–°
- **æœç´¢æ­Œæ›²** - è¿›å…¥æœç´¢é¡µé¢

### æ’­æ”¾æ§åˆ¶

- ç‚¹å‡»æ­Œæ›²å¼€å§‹æ’­æ”¾
- åº•éƒ¨æ’­æ”¾æ¡æ˜¾ç¤ºå½“å‰æ’­æ”¾æ­Œæ›²
- æ”¯æŒæ’­æ”¾/æš‚åœã€å¿«è¿›/å¿«é€€
- æ”¯æŒä½¿ç”¨ x æ§åˆ¶æš‚åœ/æ’­æ”¾
- æ”¯æŒä½¿ç”¨ L1/R1 åˆ‡æ¢ä¸Šä¸€é¦–/ä¸‹ä¸€é¦–
- å…¨å±æ’­æ”¾å™¨æ”¯æŒæ˜¾ç¤ºæ­Œè¯

## ğŸ› ï¸ å¼€å‘

### é¡¹ç›®ç»“æ„

```
decky-qqmusic/
â”œâ”€â”€ main.py                     # Python åç«¯ä¸»æ–‡ä»¶
â”œâ”€â”€ py_modules/                 # Python ä¾èµ–
â”‚   â””â”€â”€ qqmusic_api/            # QQéŸ³ä¹ API åº“
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.tsx               # å‰ç«¯å…¥å£
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ index.ts            # API è°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ index.ts            # ç»„ä»¶å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx       # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx        # é¦–é¡µï¼ˆæ¨èï¼‰
â”‚   â”‚   â”œâ”€â”€ SearchPage.tsx      # æœç´¢é¡µé¢
â”‚   â”‚   â”œâ”€â”€ PlayerPage.tsx      # å…¨å±æ’­æ”¾å™¨
â”‚   â”‚   â”œâ”€â”€ PlayerBar.tsx       # è¿·ä½ æ’­æ”¾æ¡
â”‚   â”‚   â”œâ”€â”€ SongItem.tsx        # æ­Œæ›²åˆ—è¡¨é¡¹
â”‚   â”‚   â””â”€â”€ SongList.tsx        # æ­Œæ›²åˆ—è¡¨
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ usePlayer.ts        # æ’­æ”¾å™¨çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ format.ts           # æ ¼å¼åŒ–å·¥å…·
â”‚   â””â”€â”€ types.d.ts              # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ dist/                       # æ„å»ºè¾“å‡º
â”œâ”€â”€ plugin.json                 # æ’ä»¶é…ç½®
â”œâ”€â”€ package.json                # å‰ç«¯ä¾èµ–é…ç½®
â””â”€â”€ defaults/
    â””â”€â”€ defaults.txt            # é»˜è®¤é…ç½®
```

### ç¯å¢ƒå˜é‡

æ’ä»¶ä½¿ç”¨ä»¥ä¸‹ Decky ç¯å¢ƒå˜é‡ï¼š

- `DECKY_PLUGIN_SETTINGS_DIR` - å­˜å‚¨ç”¨æˆ·å‡­è¯å’Œé…ç½®
- `DECKY_PLUGIN_LOG_DIR` - å­˜å‚¨æ—¥å¿—æ–‡ä»¶

### Python å¼€å‘ç¯å¢ƒï¼ˆuvï¼‰

æœ¬åœ°ç¼–è¾‘å™¨è¦æœ‰ QQMusicApi/Decky çš„è¡¥å…¨ä¸ç±»å‹æ£€æŸ¥ï¼Œæ¨èä½¿ç”¨ [uv](https://github.com/astral-sh/uv) åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š

```bash
# å®‰è£… uvï¼ˆå¦‚æœªå®‰è£…ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ”¾åœ¨ä»“åº“æ ¹ç›®å½•ï¼‰
uv venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# å®‰è£…é¡¹ç›®çš„ä¾èµ–
uv pip install -r requirements.txt

# å¯é€‰ï¼šå®‰è£…å¼€å‘å·¥å…·
uv pip install ruff
```

æ¿€æ´»åï¼ŒPyright/Pylance ä¼šè¯»å– `.venv` ä¸­çš„ä¾èµ–å¹¶è¯†åˆ« `decky`/`qqmusic_api` ç±»å‹ä¿¡æ¯ã€‚

### å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
pnpm run watch

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm run build
```

### éƒ¨ç½²åˆ° Steam Deck

ä½¿ç”¨ mise å¯ä»¥å¿«é€Ÿæ„å»ºå¹¶éƒ¨ç½²åˆ° Steam Deckã€‚

**0. å¼€å¯ Steam Deck SSH æœåŠ¡**ï¼ˆåœ¨ Steam Deck ä¸Šæ‰§è¡Œï¼Œåªéœ€ä¸€æ¬¡ï¼‰

```bash
# è®¾ç½® deck ç”¨æˆ·å¯†ç ï¼ˆé¦–æ¬¡éœ€è¦ï¼‰
passwd

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable --now sshd
```

**1. é…ç½® SSH å…å¯†ç™»å½•**

Linux / WSL:
```bash
ssh-copy-id deck@<STEAM_DECK_IP>
```

Windows PowerShell:
```powershell
type $env:USERPROFILE\.ssh\id_rsa.pub | ssh deck@<STEAM_DECK_IP> "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

**2. Steam Deck æƒé™é…ç½®**ï¼ˆåœ¨ Steam Deck ä¸Šæ‰§è¡Œï¼Œåªéœ€ä¸€æ¬¡ï¼‰

```bash
# ä¿®æ”¹æ’ä»¶ç›®å½•æƒé™ï¼Œå…è®¸ deck ç”¨æˆ·è¯»å†™
sudo chown -R deck:deck /home/deck/homebrew/plugins

# é…ç½® sudo å…å¯†ç ï¼ˆç”¨äºè¿œç¨‹é‡å¯æœåŠ¡ï¼‰
echo "%wheel ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/wheel
```

**3. ä¿®æ”¹é…ç½®**

ç¼–è¾‘ `.mise.toml` ä¸­çš„ `DECK_HOST`ï¼š

```toml
DECK_HOST = "deck@<STEAM_DECK_IP>"
```

**4. éƒ¨ç½²å‘½ä»¤**

```bash
# ä»…åŒæ­¥ï¼ˆå·²æ„å»ºè¿‡ï¼‰
mise run deploy

# æ„å»ºå¹¶éƒ¨ç½²
mise run dev
```

## ğŸš€ å‘ç‰ˆæµç¨‹

1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆ`plugin.json` å’Œ `package.json`ï¼‰
2. æäº¤ä»£ç ï¼š`git add . && git commit -m "release: v0.0.x"`
3. æ‰“ tagï¼š`git tag v0.0.x`
4. æ¨é€ï¼š`git push && git push --tags`
5. è¿›è¡Œ Release å‘å¸ƒæ“ä½œï¼ŒGithub Actions ä¼šè‡ªåŠ¨æ„å»ºäº§ç‰©æ”¾å…¥ Release é¡µé¢

## ğŸ“‹ å¾…åŠäº‹é¡¹

- [ ] æ‚¬æµ®æ­Œè¯

## âš ï¸ æ³¨æ„äº‹é¡¹

- éƒ¨åˆ†æ­Œæ›²å¯èƒ½éœ€è¦ QQ éŸ³ä¹ VIP æ‰èƒ½æ’­æ”¾
- è¯·éµå®ˆ QQ éŸ³ä¹çš„ä½¿ç”¨æ¡æ¬¾
- æœ¬æ’ä»¶ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨

## ğŸ“„ è®¸å¯è¯

BSD-3-Clause License

## ğŸ™ è‡´è°¢

- [Decky Loader](https://github.com/SteamDeckHomebrew/decky-loader) - Steam Deck æ’ä»¶åŠ è½½å™¨
- [QQMusicApi](https://github.com/L-1124/QQMusicApi) - QQ éŸ³ä¹ API åº“ (ä½¿ç”¨ commit: 3ccc5daaf0b3d35a4b7375824b213c07687fa992)
- [decky-plugin-template](https://github.com/SteamDeckHomebrew/decky-plugin-template) - æ’ä»¶æ¨¡æ¿
