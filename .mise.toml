[env]
# Steam Deck SSH 配置
DECK_HOST = "deck@192.168.0.2"
DECK_PLUGIN_PATH = "/home/deck/homebrew/plugins"

[tasks.clean]
description = "清理构建产物"
run = "rm -rf out/ dist/"

[tasks.build]
description = "使用 Docker 构建插件"
depends = ["clean"]
run = """
mkdir -p out
docker buildx build --output out .
"""

[tasks.deploy]
description = "同步插件到 Steam Deck"
run = """
PLUGIN_NAME=$(jq -r '.name' plugin.json)
ssh ${DECK_HOST} "sudo rm -rf ${DECK_PLUGIN_PATH}/${PLUGIN_NAME}"
ssh ${DECK_HOST} "sudo chown deck:deck /home/deck/homebrew/plugins"
rsync -avz out/${PLUGIN_NAME}/ ${DECK_HOST}:${DECK_PLUGIN_PATH}/${PLUGIN_NAME}/
ssh ${DECK_HOST} "sudo systemctl restart plugin_loader"
"""

[tasks.dev]
description = "构建并部署到 Steam Deck"
run = """
mise run build
mise run deploy
"""

[tasks.py-deps]
description = "安装 Python 开发依赖（LSP 支持）"
run = "uv sync --all-extras"
